:root {
  --bg: #0b0c10;
  --panel: #151720;
  --text: #e6e8ef;
  --subtext: #a3a8b8;
  --accent: #4f8cff;
  --accent-2: #36d399;
  --muted: #232634;
  --border: #272a36;
  --danger: #ef5350;
  --radius: 12px;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.app-header {
  position: sticky;
  top: 0; z-index: 10;
  backdrop-filter: saturate(1.2) blur(6px);
  background: color-mix(in srgb, var(--bg) 80%, transparent);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 16px;
}
.brand { font-weight: 700; letter-spacing: 0.3px; }
.tabs { display: flex; gap: 4px; }
.tab {
  appearance: none; border: 1px solid var(--border);
  background: var(--panel); color: var(--text);
  padding: 8px 12px; border-radius: 999px; font-weight: 600; font-size: 14px;
}
.tab.active { border-color: var(--accent); color: white; box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--accent) 50%, transparent); }

.section { padding: 16px; max-width: 840px; margin: 0 auto; }
.section-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
.section-header h1 { font-size: 20px; margin: 6px 0; }

.btn { appearance: none; border: 1px solid var(--border); background: var(--muted); color: var(--text); padding: 10px 14px; border-radius: 12px; font-weight: 600; }
.btn.primary { background: var(--accent); border-color: color-mix(in srgb, var(--accent) 70%, black); color: white; }
.btn.ghost { background: transparent; }
.btn.grow { flex: 1; }
.icon-btn { appearance: none; border: 0; background: transparent; color: var(--subtext); font-size: 18px; }

.view { display: block; }
.view[hidden] { display: none; }
.view.active { display: block; }

.threads { display: flex; flex-direction: column; gap: 10px; margin-top: 8px; }
.node {
  background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius);
  padding: 12px; display: flex; flex-direction: column; gap: 8px;
}
.node-header { display: flex; align-items: center; gap: 8px; }
.node-title { font-weight: 600; flex: 1; }
.node-actions { display: flex; gap: 8px; }
.node-children { display: flex; flex-direction: column; gap: 8px; padding-left: 8px; }
.node-children .node { background: #11131b; }

.empty { color: var(--subtext); padding: 16px; text-align: center; }

.kv { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; }

.modal[hidden] { display: none; }
.modal { position: fixed; inset: 0; display: grid; place-items: end center; z-index: 50; }
.modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.6); }
.modal-sheet { position: relative; width: 100%; max-width: 840px; background: var(--panel); border-top-left-radius: 16px; border-top-right-radius: 16px; border: 1px solid var(--border); padding: 12px; }
.modal-header { display: flex; align-items: center; justify-content: space-between; padding: 4px 4px 8px; border-bottom: 1px solid var(--border); }
.modal-body { padding: 12px 4px 24px; display: flex; flex-direction: column; gap: 10px; max-height: calc(100vh - 140px); overflow: auto; }

.inline-list { display: flex; flex-direction: column; gap: 8px; }
.inline-item { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: start; background: #0f1119; border: 1px solid var(--border); padding: 8px; border-radius: 10px; }
.inline-item input[type="text"], .inline-item textarea { width: 100%; background: transparent; color: var(--text); border: 1px solid var(--border); border-radius: 8px; padding: 8px; }
.inline-item textarea { min-height: 62px; resize: vertical; }
.subtext { color: var(--subtext); font-size: 12px; }

.story-stage { display: flex; flex-direction: column; gap: 12px; }
.story-progress { display: grid; grid-auto-flow: column; gap: 4px; margin-bottom: 8px; }
.segment { height: 4px; background: #2a2e3a; border-radius: 999px; overflow: hidden; }
.segment .fill { height: 100%; width: 0; background: var(--seg-color, white); opacity: 0.95; }
.segment.done .fill { width: 100%; background: white; opacity: 0.9; }
.segment.current .fill { background: var(--accent-2); width: var(--w, 0%); }
.divider { width: 2px; height: 4px; background: var(--border); border-radius: 999px; }

.story-card { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px; display: flex; flex-direction: column; gap: 12px; min-height: 300px; border-left: 6px solid var(--thread-color, var(--accent)); box-shadow: inset 6px 0 0 0 color-mix(in srgb, var(--thread-color, var(--accent)) 10%, transparent); }
.story-header { display: flex; align-items: center; gap: 8px; }
.story-title { font-size: 18px; font-weight: 700; }
.story-section { display: flex; flex-direction: column; gap: 8px; }
.tasks { display: flex; flex-direction: column; gap: 8px; }
.task { display: grid; grid-template-columns: 24px 1fr auto; gap: 8px; align-items: center; padding: 6px 8px; border: 1px solid var(--border); border-radius: 10px; background: #0f1119; }
.task.completed { opacity: 0.7; text-decoration: line-through; }
.task input[type="checkbox"] { width: 18px; height: 18px; }
.add-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; }
.add-row input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: transparent; color: var(--text); }

.priority-select { appearance: none; background: #0b0e16; color: var(--text); border: 1px solid var(--border); border-radius: 8px; padding: 6px 8px; font-size: 12px; }
.task .meta { display: flex; align-items: center; gap: 8px; }
.task .ctx { color: var(--subtext); font-size: 12px; }

/* Thread identity UI */
.thread-line { display: flex; align-items: center; gap: 8px; }
.thread-pill { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 999px; font-weight: 700; font-size: 12px; color: white; background: color-mix(in srgb, var(--thread-color, var(--accent)) 80%, black); border: 1px solid color-mix(in srgb, var(--thread-color, var(--accent)) 70%, black); }
.thread-avatar { width: 18px; height: 18px; border-radius: 999px; display: grid; place-items: center; font-size: 11px; background: color-mix(in srgb, var(--thread-color, var(--accent)) 40%, black); color: white; }
.breadcrumb { font-size: 12px; color: var(--subtext); }
.story-controls .btn.primary { background: var(--thread-color, var(--accent)); border-color: var(--thread-color, var(--accent)); color: #0b0c10; }

@media (min-width: 720px) {
  .section { padding: 20px; }
}

/* Lock screen */
.lock-overlay { position: fixed; inset: 0; z-index: 100; display: grid; place-items: center; background: rgba(0,0,0,.6); backdrop-filter: blur(6px); }
.lock-overlay[hidden] { display: none !important; }
.lock-card { width: min(92vw, 420px); background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.4); display: flex; flex-direction: column; gap: 12px; }
.lock-title { font-size: 22px; font-weight: 800; }
.lock-sub { color: var(--subtext); }
.lock-form { display: flex; flex-direction: column; gap: 10px; }
.lock-form input[type="password"] { padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: transparent; color: var(--text); }
.lock-remember { display: flex; align-items: center; gap: 8px; color: var(--subtext); font-size: 13px; }
.lock-msg { min-height: 18px; color: var(--danger); font-size: 13px; }
